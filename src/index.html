<html>

<head>
  <title>Git</title>
  <meta charset="utf8">
</head>

<body>
  <div class=root>
    Loading...
  </div>
  <script src="/assets/browserfs.js"></script>
  <script nomodule type=text/javascript>
  document.body.innerHTML = "Please use modern browser. (I checked to work only latest chrome)"
  </script>
  <script type=module>
function setupBrowserFS() {
  return new Promise(resolve => {
    BrowserFS.configure({ fs: "IndexedDB", options: {} }, err => {
      if (err) {
        throw err
      }
      resolve()
    })
  })
}

async function setupServiceWorker() {
  if ('serviceWorker' in navigator) {
    await navigator.serviceWorker.register('/sw.js');
  }  
}

;(async () => {
  const el = document.querySelector('.root')

  // SW
  el.innerHTML = 'Checking service worker ...'
  await import('/sw.js')

  // setup
  await setupBrowserFS()

  // Run
  el.innerHTML = 'Loading...'
  await import('/main.js')
})()
  </script>
</body>

</html>